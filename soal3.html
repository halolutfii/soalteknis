WITH UNPAID_ANGSURAN AS (
    SELECT 
        k.KONTRAK_NO,
        k.CLIENT_NAME,
        SUM(j.ANGSURAN_PER_BULAN) AS TOTAL_ANGSURAN_BELUM_TERBAYAR,
        MIN(j.TANGGAL_JATUH_TEMPO) AS TANGGAL_MULAI_TUNGGAKAN
    FROM 
        KONTRAK k
    JOIN 
        JADWAL_ANGSURAN j ON k.KONTRAK_NO = j.KONTRAK_NO
    WHERE 
        k.CLIENT_NAME = 'SUGUS'
        AND j.TANGGAL_JATUH_TEMPO BETWEEN '2024-05-01' AND '2024-08-14'
    GROUP BY 
        k.KONTRAK_NO, k.CLIENT_NAME
)
SELECT 
    KONTRAK_NO,
    CLIENT_NAME,
    TOTAL_ANGSURAN_BELUM_TERBAYAR,
    ROUND(TOTAL_ANGSURAN_BELUM_TERBAYAR * 0.001 * DATEDIFF('2024-08-14', TANGGAL_MULAI_TUNGGAKAN), 2) AS TOTAL_DENDA
FROM 
    UNPAID_ANGSURAN;